<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Country Game</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        #c{
            border: 1px solid black;
            margin-left: 0.5%;
        }
        #starterButton{
            position: absolute;
            left: 540px;
            top: 320px;
            width: 300px;
            height: 50px;
            font-size: xx-large;
            text-align: center;
            background-color: #4d94ff;
            border-radius: 8px;
            color: white;
            border: none;
        }
        h1{
            margin: auto;

        }
        #stopwatch {
            text-align: center;
            overflow: hidden;
        }
        #return1{
            float: left;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Spoj Slovensko</h2>
    <nav class="navbar navbar-dark bg-primary">
        <!-- Navbar content -->
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Brand</a>
            </div>
        </div>
    </nav>
</div>
<div>

</div>
<button id="starterButton" onclick="startGame();timer()">START GAME</button>
<canvas id="c" width ="1500" height = "700" ></canvas>
<div class="nav">
    <a href="http://147.175.98.102/~xmartinez/Zav_Final/webte/index.html" id="return1">
        <img src="img/back.png" alt="back" width="50" height="50"/>
    </a>
    <h1 id="stopwatch"><time>00:00:00</time></h1>
</div>
<script>
    var canvas = $("#c");
    var c = canvas[0].getContext("2d");

    var img = new Image();
    img.src = 'img/SK3.png';
    img.onload = function() {
        c.drawImage(this, 250, 0);
    };

    var images2 = [];
    var image1 = new DragImage('img/BA.png', 10, 50);
    var image2 = new DragImage('img/TN.png', 1250, 250);
    var image3 = new DragImage('img/NT.png', 10, 220);
    var image4 = new DragImage('img/TT.png', 400, 480);
    var image5 = new DragImage('img/ZA.png', 1200, 10);
    var image6 = new DragImage('img/BB.png', 650, 480);
    var image7 = new DragImage('img/PO.png', 1000, 490);
    var image8 = new DragImage('img/KE.png', 10, 520);

    var images = [image1,image2,image3,image4,image5,image6,image7,image8];

    console.log(images2);
    console.log(images);

    function findImage(x,y){                                            //najdi ktory obrazok si klikol
        for (i = 0;i < images2.length ; i++){
            if (images[i].x < x && (images[i].x+images2[i].width) > x
                && images[i].y < y && (images[i].y+images2[i].height) > y){
                return i;
            }
        }
    }
    var completed = [false,false,false,false,false,false,false,false];  //Kraj na spravnom mieste ked true
    function checkPosition(number,x,y){
        switch (number) {
            case 0:
                if (!completed[0]) {                                    //ak BA kraj este nie je na spravnom mieste
                    if (265 < x && (285 + images2[0].width) > x
                        && 230 < y && (250 + images2[0].height) > y) {  //skontroluj suradnice pustenia
                        console.log('Picture Number 0');
                        images[0].x = 275;
                        images[0].y = 240;                              //presun na spravne miesto
                        completed[0] = true;                            //uz je na svojom mieste
                        console.log(completed);
                    } else {                                            //ak bol pusteni mimo suradnic
                        images[0].x = 10;
                        images[0].y = 50;                               //vrat na povodne miesto
                    }
                } else {
                    images[0].x = 275;
                    images[0].y = 240;
                }
                break;
            case 1:
                if (!completed[1]) {
                    if (285 < x && (305 + images2[1].width) > x
                        && 177 < y && (197 + images2[1].height) > y) {
                        console.log('Picture Number 1');
                        images[1].x = 295;
                        images[1].y = 187;
                        completed[1] = true;
                    } else {
                        images[1].x = 1250;
                        images[1].y = 250;
                    }
                } else {
                    images[1].x = 295;
                    images[1].y = 187;
                }
                break;
            case 2:
                if (!completed[2]) {
                    if (396 < x && (416 + images2[2].width) > x
                        && 226 < y && (246 + images2[2].height) > y) {
                        console.log('Picture Number 2');
                        images[2].x = 406;
                        images[2].y = 230;
                        completed[2] = true;
                    } else {
                        images[2].x = 10;
                        images[2].y = 220;
                    }
                } else {
                    images[2].x = 406;
                    images[2].y = 230;
                }
                break;
            case 3:
                if (!completed[3]) {
                    if (350 < x && (370 + images2[3].width) > x
                        && 80 < y && (100 + images2[3].height) > y) {
                        console.log('Picture Number 3');
                        images[3].x = 361;
                        images[3].y = 87;
                        completed[3] = true;
                    } else {
                        images[3].x = 400;
                        images[3].y = 480;
                    }
                } else {
                    images[3].x = 361;
                    images[3].y = 87;
                }
                break;
            case 4:
                if (!completed[4]) {
                    if (512 < x && (532 + images2[4].width) > x
                        && 15 < y && (35 + images2[4].height) > y) {
                        console.log('Picture Number 4');
                        images[4].x = 522;
                        images[4].y = 25;
                        completed[4] = true;
                    } else {
                        images[4].x = 1200;
                        images[4].y = 10;
                    }
                } else {
                    images[4].x = 522;
                    images[4].y = 25;
                }
                break;
            case 5:
                if (!completed[5]) {
                    if (526 < x && (546 + images2[5].width) > x
                        && 173 < y && (193 + images2[5].height) > y) {
                        console.log('Picture Number 5');
                        images[5].x = 536;
                        images[5].y = 183;
                        completed[5] = true;
                    } else {
                        images[5].x = 650;
                        images[5].y = 480;
                    }
                } else {
                    images[5].x = 536;
                    images[5].y = 183;
                }
                break;
            case 6:
                if (!completed[6]) {
                    if (749 < x && (769 + images2[6].width) > x
                        && 55 < y && (75 + images2[6].height) > y) {
                        console.log('Picture Number 6');
                        images[6].x = 759;
                        images[6].y = 65;
                        completed[6] = true;
                    } else {
                        images[6].x = 1000;
                        images[6].y = 490;
                    }
                } else {
                    images[6].x = 759;
                    images[6].y = 65;
                }
                break;
            case 7:
                if (!completed[7]) {
                    if (795 < x && (815 + images2[7].width) > x
                        && 157 < y && (177 + images2[7].height) > y) {
                        console.log('Picture Number 7');
                        images[7].x = 805;
                        images[7].y = 167;
                        completed[7] = true;
                    } else {
                        images[7].x = 10;
                        images[7].y = 520;
                    }
                } else {
                    images[7].x = 805;
                    images[7].y = 167;
                }
                break;
        }
    }

    function allCompleted(){
        for (i = 0; i < completed.length;i++){
            if (!completed[i]){
                return false;
            }
        }
        return true;
    }

    function startGame(){
        var button = document.getElementById('starterButton');
        button.style.visibility = "hidden";
        var loop = setInterval(function() {
            c.fillStyle = "azure";
            c.fillRect(0, 0, 1500, 700);
            c.drawImage(img, 250, 0);
            if (allCompleted()){
                var myLayer = document.createElement('div');
                myLayer.id = 'bookingLayer';
                myLayer.style.position = 'absolute';
                myLayer.style.left = '540px';
                myLayer.style.top = '320px';
                myLayer.style.width = '300px';
                myLayer.style.height = '50px';
                myLayer.style.fontSize = "xx-large";
                myLayer.style.fontWeight = "900";
                myLayer.style.textAlign = "center";
                myLayer.style.background = '#4d94ff';
                myLayer.style.color = 'white';
                myLayer.style.borderRadius = '8px';
                myLayer.innerHTML = 'GAME WON';
                document.body.appendChild(myLayer);
                clearInterval(loop);
                clearTimeout(t);
            }
            for (i = 0; i < images.length ; i++){
                images[i].update();
            }
        }, 30);
    }

    var mouseX = 0,
        mouseY = 0;
    var mousePressed = false;
    var dragging = false;

    var clickedImgNumber = -1;
    canvas.mousemove(function(e) {
        mouseX = e.offsetX;
        mouseY = e.offsetY;
    })
    $(document).mousedown(function(e) {
        mousePressed = true;
        mouseX = e.offsetX;
        mouseY = e.offsetY;
        console.log('MouseX: ' + mouseX + ' MouseY: ' + mouseY);
        clickedImgNumber = findImage(mouseX,mouseY);
        console.log(clickedImgNumber);
    }).mouseup(function(e) {
        mousePressed = false;
        dragging = false;
        console.log(dragging);
        mouseX = e.offsetX;
        mouseY = e.offsetY;
        console.log('MouseX: ' + mouseX + ' MouseY: ' + mouseY);
        if (clickedImgNumber >= 0){                                           //ak bol kliknuti nejaky obrazok
            checkPosition(clickedImgNumber,mouseX,mouseY);                     //skontroluj ci bol pusteni na spravne miesto
        }
    });

    function DragImage(src, x, y) {                                 //draggable obrazok
        var that = this;
        var startX = 0,
            startY = 0;
        var drag = false;
        this.x = x;
        this.y = y;
        var img = new Image();
        img.src = src;
        images2.push(img);
        this.update = function() {
            if (mousePressed) {
                var left = that.x;
                var right = that.x + img.width;
                var top = that.y;
                var bottom = that.y + img.height;
                if (!drag) {
                    startX = mouseX - that.x;
                    startY = mouseY - that.y;
                }
                if (mouseX < right && mouseX > left && mouseY < bottom && mouseY > top) {
                    if (!dragging){
                        dragging = true;
                        drag = true;
                        console.log(dragging);
                    }
                }
            } else {
                drag = false;
            }

            if (drag) {
                that.x = mouseX - startX;
                that.y = mouseY - startY;
            }
            c.drawImage(img, that.x, that.y);
        }
    }
    var h1 = document.getElementsByTagName('h1')[0],
        seconds = 0, minutes = 0, hours = 0,
        t;

    function add() {
        seconds++;
        if (seconds >= 60) {
            seconds = 0;
            minutes++;
            if (minutes >= 60) {
                minutes = 0;
                hours++;
            }
        }

        h1.textContent = (hours ? (hours > 9 ? hours : "0" + hours) : "00") + ":" + (minutes ? (minutes > 9 ? minutes : "0" + minutes) : "00") + ":" + (seconds > 9 ? seconds : "0" + seconds);

        timer();
    }
    function timer() {
        t = setTimeout(add, 1000);
    }

</script>
</body>
</html>